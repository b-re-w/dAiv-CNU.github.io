<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta content="webkit" name="renderer">

    <title>OnlineJudge</title>
    <link rel="shortcut icon" href="/dist/res/image/favicon.ico">
    <style>
        html, body {
            margin: 0;
            padding: 0;
            height: 100%;
            overflow: hidden;
        }
        #judge_iframe {
            width: 100%;
            height: 100vh;
            border: none;
        }
    </style>
</head>
<body>
    <section id="judge">
        <iframe id="judge_iframe" src="https://daiv-cnu.duckdns.org/judge/" allow="web-share"
                root_url="https://daiv-cnu.duckdns.org/judge">
        </iframe>
    </section>

    <script>
        const redirectPath = sessionStorage.getItem('redirect-path');
        const iframe = document.getElementById('judge_iframe');
        if (redirectPath) {  // if page is refreshed
            sessionStorage.removeItem('redirect-path');  // pull out the value
            // URL update without page refresh using History API
            window.history.replaceState(null, null, redirectPath);
            iframe.src = 'https://daiv-cnu.duckdns.org' + redirectPath;
        }
    </script>

    <script>
        window.addEventListener('message', function(event) {
            if (event.origin !== 'https://daiv-cnu.duckdns.org') {
                if (event.origin === 'https://daiv-cnu.github.io') {
                    console.log('Redirecting to', event.data.url);
                    window.location.href = event.data.url;
                }
                return;
            }

            if (event.data.type === 'page-info') {
                if (event.data.url) {
                    window.history.replaceState(null, null, event.data.url.replace('https://daiv-cnu.duckdns.org', ''));
                }
                if (event.data.title) {
                    document.title = event.data.title;
                }
            }
        });
    </script>
</body>
</html>
