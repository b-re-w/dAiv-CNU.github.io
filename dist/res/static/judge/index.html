<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta content="webkit" name="renderer">

    <title>OnlineJudge</title>
    <link rel="shortcut icon" href="/dist/res/image/favicon.ico">

    <script>
        const redirectPath = sessionStorage.getItem('redirect-path');
        if (redirectPath) {  // if page is refreshed
            sessionStorage.removeItem('redirect-path');  // pull out the value
            // URL update without page refresh using History API
            window.history.replaceState(null, null, redirectPath);
        }
    </script>

    <style>
        html, body {
            margin: 0;
            padding: 0;
            height: 100%;
            overflow: hidden;
        }
        #judge_iframe {
            width: 100%;
            height: 100vh;
            border: none;
        }
    </style>
</head>
<body>
    <section id="judge">
        <iframe id="judge_iframe" src="https://dAiv-CNU.duckdns.org/judge/index.html"
                sandbox="allow-same-origin allow-scripts allow-popups allow-forms"
                root_url="https://dAiv-CNU.duckdns.org/judge">
        </iframe>
    </section>
    <script>
        const iframe = document.getElementById('judge_iframe');

        iframe.addEventListener('load', function() {
            const iframeTitle = iframe.contentDocument.title;
            if (iframeTitle) {
                document.title = iframeTitle;
            }

            // IFrame MutationObserver
            const titleObserver = new MutationObserver(function() {
                document.title = iframe.contentDocument.title;
            });

            // Observe IFrame Title
            if (iframe.contentDocument.querySelector('title')) {
                titleObserver.observe(iframe.contentDocument.querySelector('title'), {
                    subtree: true,
                    characterData: true,
                    childList: true
                });
            }

            // URL Sync
            const iframeLocation = iframe.contentWindow.location;
            if (iframeLocation.href !== window.location.href) {
                history.replaceState(null, document.title, iframeLocation.pathname + iframeLocation.search + iframeLocation.hash);
            }
            iframe.contentWindow.addEventListener('popstate', function() {
                history.replaceState(null, iframe.contentDocument.title,
                    iframe.contentWindow.location.pathname +
                    iframe.contentWindow.location.search +
                    iframe.contentWindow.location.hash);
            });
        });
    </script>
</body>
</html>
